<!doctype html>

<script src="/node_modules/systemjs/dist/system-register-only.js"></script>
<script>
  navigator.serviceWorker.onerror = function(e){
    console.error(e);
  };

  navigator.serviceWorker.register('./service-worker.js').then(function(reg) {
    console.log('Service worker registered');
    console.log(reg.waiting, reg.installing, reg.active);

    console.log('import');
    return System.import('modules/page1.js').then(function(m) {
      document.querySelector('pre').innerText = m.default().join('\n')+'\n'+window.performance.now();
    });
  }).catch(e => console.error(e.message, e.stack));

  function unregister(){
    navigator.serviceWorker.getRegistrations().then(function(regs){
      regs.forEach(function(reg){
        console.log('Service worker unregistered', reg);
        reg.unregister();
      });
    });
  }

  function clearCache(){
    navigator.serviceWorker.controller.postMessage({command: 'clearCache'});
  }
</script>

<h1>Home</h1>
<pre></pre>
<hr />
<a href="page2.html">Page 2</a> | <a href="page3.html">Page 3</a>
<hr />
<button type="button" onclick="unregister()">Unregister</button>
<button type="button" onclick="clearCache()">Clear cache</button>